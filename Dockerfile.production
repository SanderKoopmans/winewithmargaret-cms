FROM --platform=linux/amd64 node:16

WORKDIR /opt/

COPY ./package.json ./
COPY ./package-lock.json ./

RUN touch .env

ENV NODE_ENV=production

RUN echo "Running with ENV $NODE_ENV"
RUN npm install

RUN npm run build

COPY . .

EXPOSE 1337

CMD ["node", "node_modules/@strapi/strapi/bin/strapi", "start"]